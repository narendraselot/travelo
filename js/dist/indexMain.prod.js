"use strict";var firebaseConfig={apiKey:"AIzaSyAayDcLEEcBmJbrH3ZbzBEQKVB2vVXcNFo",authDomain:"gidctouristguide.firebaseapp.com",projectId:"gidctouristguide",storageBucket:"gidctouristguide.appspot.com",messagingSenderId:"97113204612",appId:"1:97113204612:web:32805840ef567315d9dfd1",measurementId:"G-PWFPWG4PF5"};firebase.initializeApp(firebaseConfig),firebase.analytics();var db=firebase.firestore();function setMobileMenu(){window.matchMedia("(max-width: 767px)").matches?($("#navigation").addClass("invisible"),$("#navMobileNav").removeClass("invisible"),$("#ulMobileNav").removeClass("invisible"),$("#ulMobileNav").html($("#navigation").html()),$(".logo").addClass("invisible")):($("#navigation").removeClass("invisible"),$("#navMobileNav").addClass("invisible"),$("#ulMobileNav").addClass("invisible"),$(".logo").removeClass("invisible"))}function searchUsingLatLon(){$("#iframeLocation").removeClass("invisible"),$("#divWeather").removeClass("invisible"),$("#iframeLocation").html('<iframe id="iframeWithCityMap" src="https://maps.google.com/maps?q='+$("#txtLocationLatLong").val()+'+Hotels&output=embed&query=Hotel+Tour&map_action=pano" class="responsive-iframe" style="border:0;" allowfullscreen="true" loading="lazy"></iframe>'),getWeatherDetails($("#txtLocationLatLong").val())}function getWeatherDetails(CityWithCountry){var city=CityWithCountry.split(",")[0],weatherURL="https://api.openweathermap.org/data/2.5/weather?q="+city+"&appid=f13e12d2bf352be97dfefa35c2e9faeb&units=metric&temp=Celsius";$.ajax({url:weatherURL,dataType:"json",data:"",success:function(e){var i,n,t,a,o,s,l,r,c,u,d,m;e&&(o=a=t=n=i="",e.main&&(i=e.main.feels_like,n=e.main.humidity,e.main.pressure,e.main.temp,e.main.temp_max,e.main.temp_min),s=e.weather,e.wind&&(o=e.wind.speed),s&&0<s.length&&(s[0].id,t=s[0].main,s[0].description,a=s[0].icon),r=(l=new Date).getTimezoneOffset(),u=(c=new Date(l.getTime()+6e4*(330+r))).getHours(),d=c.getMinutes(),m='<div class="container-fluid"><div class="row justify-content-center">   <div class="col-12 col-md-12 col-sm-12 col-xs-12">       <div class="card Wethcard p-4">           <div class="d-flex" style="font-family:Trebuchet MS !important;">               <h6 class="flex-grow-1">'+city+" </h6>&nbsp;&nbsp;               <h6> "+u+" : "+d+'</h6>           </div>           <div class="d-flex flex-column Wethtemp mt-5 mb-3">               <h1 class="mb-0 font-weight-bold" id="heading"> '+i+'Â° C </h1>                <span class="small Wethgrey">'+t+'</span>           </div>           <div class="d-flex">               <div class="Wethtemp-details flex-grow-1">                   <p class="my-1"> <img src="https://i.imgur.com/B9kqOzp.png" height="17px"> <span> '+o+' mp/h                       </span> </p>                   <p class="my-1"> <i class="fa fa-tint mr-2" aria-hidden="true"></i> <span> '+n+'% </span> </p>               </div>               <div> <img draggable="false" src="https://openweathermap.org/img/wn/'+a+'@2x.png" width="100px"> </div>           </div>       </div>   </div></div></div>',$("#divWeather").html(m))},error:function error(_error){alert("error; "+eval(_error))}})}function autoAddCities(n,t){$("#txtLocationLatLong").val(""),$("#iframeLocation").html(null),$("#iframeLocation").addClass("invisible"),$("#divWeather").addClass("invisible"),$("#divWeather").html(null),$("#"+n).autocomplete({source:function(e,i){$.ajax({url:"https://secure.geobytes.com/AutoCompleteCity?key=7c756203dbb38590a66e01a5a3e1ad96&callback=?&q="+t,dataType:"json",data:"",success:function(e){e&&i($.map(e,function(e){if("%s"!=e&&null!=e&&null!=e)return{label:e,value:e,coordinates:e,country_name:e}}))}})},select:function(e,i){return $("#"+n).val(i.item.label),$("#txtLocationLatLong").val(String(i.item.coordinates)),!1}})}function renderCaptcha(){$("#captchaContainer").length&&0<$("#captchaContainer").length&&(window.recaptchaVerfier=new firebase.auth.RecaptchaVerifier("captchaContainer"),recaptchaVerfier.render())}function logout(){firebase.auth().signOut(),setInterval(function(){window.location.href="index.html"},500)}function login(){$("#hdnUserType").val("user"),Swal.fire({title:"Login",html:"<a id=\"btnSignInGoogle\" class=\"genric-btn success radius\" style='cursor:pointer' onclick=\"signInGoogle()\">Google <i class='fa fa-google'></i></a><p>or<br><button type='button' class='btn btn-primary' onclick='signInUsingPhoneNumber()'>Sign In Using Phone</button>",confirmButtonText:"Sign in",showCloseButton:!0,showCancelButton:!0,showConfirmButton:!1,focusConfirm:!1})}function signInFacebook(){Swal.close();var e=new firebase.auth.FacebookAuthProvider;firebase.auth().signInWithPopup(e).then(function(e){var i=e.credential,n=e.user;n&&(n.Email,$("#login").addClass("invisible"),$("#Moblogin").addClass("invisible"),$("#Username").removeClass("invisible"),$("#MobUsername").removeClass("invisible"),$("#Photo").removeClass("invisible"),$("#MobPhoto").removeClass("invisible"));i.accessToken}).catch(function(e){e.code,e.message,e.email,e.credential})}function signInGoogle(){var e=new firebase.auth.GoogleAuthProvider;firebase.auth().signInWithPopup(e).then(function(e){Swal.close();e.credential.accessToken,e.user;window.location.href=window.location.href}).catch(function(e){Swal.close();e.code,e.message,e.email,e.credential})}function guideSignIn(){$("#hdnUserType").val("guide"),Swal.close(),Swal.fire({title:"Guide Login",html:"<a id=\"btnSignInGoogle\" class=\"genric-btn success radius\" style='cursor:pointer' onclick=\"signInGoogle()\">Google <i class='fa fa-google'></i></a><p>or<br><button type='button' class='btn btn-primary' onclick='signInUsingPhoneNumber()'>Sign In Using Phone</button>",confirmButtonText:"Sign in",showCloseButton:!0,showCancelButton:!0,showConfirmButton:!1,focusConfirm:!1})}function signUpGuide(){startLoading();var d="",m="";firebase.auth().onAuthStateChanged(function(e){var o,s,l,r,c,i,u,n;e?(o=e.uid,s=$("#txtAgencyName").val(),l=$("#txtContact").val(),r=$("#txtAddress").val(),c=$("#txtServiceLocation").val(),i=!1,u=$("#txtbaseLocation").val(),d=$("#txtGuideEmail").val(),m=$("#txtGuideName").val(),(n="")!=u&&null!=u||(i=!0,n+=" Base Location "),""!=s&&null!=s||(i=!0,n+=" Agency Name "),""!=l&&null!=l||(i=!0,n+="Contact "),""!=r&&null!=r||(i=!0,n+=" Address "),""!=c&&null!=c||(i=!0,n+=" ServiceLocation "),""!=d&&null!=d||(i=!0,n+=" Name Of Guide "),""!=m&&null!=m||(i=!0,n+=" User Email "),n+=" is/are compulsory Fields",i?(stopLoading(),Swal.fire("Oops!",n,"error")):db.collection("GuideInfo").get().then(function(e){var n=!0,t={},a=!0;e.forEach(function(e){if(e.id==u){n=!1,t=e.data(),arrayToSet=t.AgencyDetails;for(var i=0;i<arrayToSet.length;i++)if(arrayToSet[i].UID==o){a=!1;break}a?arrayToSet.push({AgencyName:s,Contact:l,Address:r,ServiceLocation:c,guideEmail:d,GuideName:m,UID:o}):toast("Data Already Present","info")}}),n&&(arrayToSet=[],arrayToSet.push({AgencyName:s,Contact:l,Address:r,ServiceLocation:c,guideEmail:d,GuideName:m,UID:o}),t.AgencyDetails=arrayToSet),a&&db.collection("GuideInfo").doc(u).set(t).then(function(){stopLoading(),Swal.fire("Success!","Details Saved","success"),setInterval(function(){window.location.href=window.location.href},1e3)}).catch(function(e){console.error("Error writing document: ",e),stopLoading()})}).catch(function(e){stopLoading(),console.log("Error getting documents: ",e)})):Swal.fire("Oops!","Please Login","error")})}function signInUsingPhoneNumber(){Swal.close(),$("#divSignInWithNumber").removeClass("invisible")}function sendOTP(){var e=getPhoneNumberFromUserInput();e?firebase.auth().signInWithPhoneNumber(e,window.recaptchaVerfier).then(function(e){window.confirmationResult=e,firebaseNumberResult=e,console.log(e),toast("OTP Sent","success")}).catch(function(e){toast(e,"error")}):toast("Number cannot be empty","error")}function verifyOTPAndSignIn(){var e=getOTPUserInput();e?firebaseNumberResult.confirm(e).then(function(e){toast("Sign In Success","success");e.user;setInterval(function(){window.location.href=window.location.href},500)}).catch(function(e){toast(e,"error")}):toast("OTP Cannot be empty","error")}function getPhoneNumberFromUserInput(){return $("#txtPhoneNumber").val()?($("#txtPhoneNumber").val($("#txtPhoneNumber").val().replace("+91","")),"+91"+$("#txtPhoneNumber").val()):null}function getOTPUserInput(){return $("#txtOTP").val()?$("#txtOTP").val():null}function toast(e,i){Swal.mixin({toast:!0,position:"bottom",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(e){e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:i,title:e})}function startLoading(){$("#loading").removeClass("invisible")}function stopLoading(){$("#loading").addClass("invisible")}firebaseNumberResult="",$(function(){setMobileMenu(),$(window).resize(function(){setMobileMenu()}),$("#txtLocationLatLong").val(""),firebase.auth().onAuthStateChanged(function(e){var i,n,t,o;e?(i=e.email,n=e.photoURL,t=e.displayName,o=e.uid,0<$("#txtGuideEmail").length&&0<$("#txtGuideName").length&&(startLoading(),i&&$("#txtGuideEmail").val(i),t&&$("#txtGuideName").val(t),db.collection("GuideInfo").get().then(function(e){var n={},t=!1,a={};e.forEach(function(e){n=e.data(),arrayToSet=n.AgencyDetails;for(var i=0;i<arrayToSet.length;i++)if(arrayToSet[i].UID==o){a=arrayToSet[i],$("#txtAgencyName").val(a.AgencyName),$("#txtContact").val(a.Contact),$("#txtAddress").val(a.Address),$("#txtServiceLocation").val(a.ServiceLocation),$("#txtbaseLocation").val(e.id),$("#txtGuideEmail").val(a.guideEmail),$("#txtGuideName").val(a.GuideName),t=!0;break}t?($("#mainForm :input").attr("disabled",!0),$("#mainForm :button").attr("disabled",!0)):($("#mainForm :input").attr("disabled",!1),$("#mainForm :button").attr("disabled",!1))}),stopLoading()}).catch(function(e){console.log("Error getting documents: ",e),stopLoading()})),null==t&&(t="New User"),null==n&&(n="./img/defuser.webp"),e.uid,$("#login").addClass("invisible"),$("#Moblogin").addClass("invisible"),$("#Username").removeClass("invisible"),$("#MobUsername").removeClass("invisible"),$("#Photo").removeClass("invisible"),$("#MobPhoto").removeClass("invisible"),$("#liLogout").removeClass("invisible"),$("#MobliLogout").removeClass("invisible"),$("#guidelogin").addClass("invisible"),$("#Mobguidelogin").addClass("invisible"),$("#Username").html("<a>"+t+"&nbsp;&nbsp;</a>"),$("#MobUsername").html("<a>"+t+"&nbsp;&nbsp;</a>"),$("#dpPhoto").attr("src",n).after("<i>&nbsp;</i>"),$("#MobdpPhoto").attr("src",n).after("<i>&nbsp;</i>"),"guide"==$("#hdnUserType").val()&&(document.location.href="GuideDetails.html")):($("#login").removeClass("invisible"),$("#Moblogin").removeClass("invisible"),$("#Username").addClass("invisible"),$("#MobUsername").addClass("invisible"),$("#Photo").addClass("invisible"),$("#MobPhoto").addClass("invisible"),$("#guidelogin").removeClass("invisible"),$("#Mobguidelogin").removeClass("invisible"),$("#Username").html(""),$("#MobUsername").html(""),$("#dpPhoto").attr("src",""),$("#MobdpPhoto").attr("src",""),$("#liLogout").addClass("invisible"),$("#MobliLogout").addClass("invisible")),setMobileMenu()}),$("#btnLogout").on("click",function(){logout()}),$("#btnLogin").on("click",function(){login()}),$("#MobbtnLogin").on("click",function(){login()}),$("#btnGuideLogin").on("click",function(){guideSignIn()}),$("#MobbtnGuideLogin").on("click",function(){guideSignIn()}),$("#btnSubmitGuideDetails").on("click",function(){signUpGuide()}),$("#btnCancelGuideDetails").on("click",function(){document.location.href="/"}),$("#btnSendOTP").on("click",function(){sendOTP()}),$("#btnSignUpUsingNumber").on("click",function(){verifyOTPAndSignIn()}),renderCaptcha(),$("#searchLocation, #txtTopSearch").on("input",function(){var e=$(this).val();autoAddCities($(this).attr("id"),e)}),$("#btnLocationSearchOnMap").on("click",function(){$("#txtLocationLatLong").val()?searchUsingLatLon():toast("Oops, Please select a valid Location","info")})});