"use strict";function getAllGuides(){$("#tableListForGuide").html(null),db.collection("GuideInfo").get().then(function(e){var i={},o={},a="<tbody id='myTable'>";e.forEach(function(e){a+='<tr><td><div id="accordion'+String(e.id)+'"><div class="card"><div class="card-header"><a class="card-link" data-toggle="collapse" href="#collapseOne'+String(e.id)+'">'+String(e.id)+'</a></div><div id="collapseOne'+String(e.id)+'" class="collapse" data-parent="#accordion'+String(e.id)+'"><div class="card-body">',a+='<div class="table-responsive"><table class="table table-bordered" id="tableListForGuideInternal'+String(e.id)+'"> ',a+="<thead><tr><th>Agency Name</th><th>Address</th><th>Details</th></tr></thead><tbody>",i=e.data(),arrayToSet=i.AgencyDetails;for(var t=0;t<arrayToSet.length;t++)o=arrayToSet[t],a+="<tr>",a+="<td>"+o.AgencyName+"</td>",a+="<td>"+o.Address+"</td>",a+="<td><button class='btn btn-info' onclick='showGuideDetils(this)' id='btnViewDetails"+String(e.id+t)+"' data-UID='"+o.UID+"' data-allDetails='"+JSON.stringify(o)+"' type='button'>View Details &nbsp;<i class='fa fa-info'></i></button></td>",a+="</tr>";a+="<tbody></table></div>",a+="</div></div></div> </div></td></tr>"}),a+="</tbody>",$("#tableListForGuide").html("<thead><tr><th>City</th></tr></thead>"+a)}).catch(function(e){console.log("Error getting documents: ",e),stopLoading()})}function showGuideDetils(e){var t=JSON.parse($(e).attr("data-allDetails")),i="<div class='row' id='rowForDetails'><input type='hidden' value='"+String($(e).attr("data-UID"))+"' id='hdnGuideID'>",o=String(JSON.stringify(t));i+="<input type='hidden' value='"+o+"' id='hdnAllDetails'>",$.each(t,function(e,t){e&&"UID"!=String(e)&&(i+='<div class="col-sm-12 col-lg-12 col-md-12" style="padding:3px;margin:3px;width:100%;"><button style="width:100%;"  type="button" class="btn btn-primary text-left">'+e+' : &nbsp;<span class="badge badge-light">'+t+"</span></button></div>")}),i+="</div>",Swal.fire({title:"<strong>Guide Details</strong>",icon:"info",html:i,showCloseButton:!0,showCancelButton:!0,focusConfirm:!1,didRender:function(){0<$(".datepicker").length&&$(".datepicker").remove(),$('<div class="row text-center"><div class="col-sm-12 col-lg-12 col-md-12 text-center" style="margin:3px;"><input type="text" placeholder="Select Date" class="form-input datepicker" style="width:100% !important;overflow:visible;"/></div><div class="col-sm-12 col-lg-12 col-md-12 text-center" style="margin:3px;"><input type="text" id="txtCustomerName" placeholder="Full Name" class="swal2-input" style="width:100% !important;overflow:visible;"/></div></div>').insertAfter("#rowForDetails"),$(".datepicker").datepicker({format:"mm/dd/yyyy",startDate:"-3d"})},confirmButtonText:'<i class="fa fa-thumbs-up"></i> Book Guide!',cancelButtonText:'<i class="fa fa-thumbs-down"></i> Cancel',preConfirm:function(){null==$(".datepicker").val()||""==$(".datepicker").val()||null==$(".datepicker").val()||null==$("#txtCustomerName").val()||""==$("#txtCustomerName").val()||null==$("#txtCustomerName").val()?(Swal.hideLoading(),Swal.showValidationMessage("Please select a valid date & Name")):(Swal.showLoading(),bookGuideSendToFirebase($("#txtCustomerName").val()))}})}function bookGuideSendToFirebase(d){var l,e;null!=$(".datepicker").val()&&""!=$(".datepicker").val()&&null!=$(".datepicker").val()||null!=d&&""!=d&&null!=d?(l=JSON.parse($("#hdnAllDetails").val()),e=$(".datepicker").val(),l.BookedDate=e,firebase.auth().onAuthStateChanged(function(e){var n;e?(n=e.uid,db.collection("Booking").doc(n).get().then(function(e){var t,i,o,a;0<e.size?e.exists?(i=(t=e.data()).BookingDetails,l.UserId=n,l.CustomerName=d,i.push(l),t.BookingDetails=i,db.collection("Booking").doc(n).set(t).then(function(){Email.send({SecureToken:"8d4f68cb-5259-4e47-a3a2-dd219901e043",To:l.guideEmail,From:"tooristguide@gmail.com",Subject:"Hey a new User just booked you as a guide!",Body:"Hola Guide,<br> \n New Booking has arrived, please login to your Tourist Guide Account or refer this link : https://touristguide.netlify.com"}).then(function(e){console.log(e),Swal.hideLoading(),Swal.fire("Guide Booked!","","success")})}).catch(function(e){Swal.hideLoading(),Swal.fire("Oops! Something Went Wrong "+e,"","error")})):(o=[],l.UserId=n,l.CustomerName=d,o.push(l),(a={}).BookingDetails=o,db.collection("Booking").doc(n).set(a).then(function(){Email.send({SecureToken:"8d4f68cb-5259-4e47-a3a2-dd219901e043",To:l.guideEmail,From:"tooristguide@gmail.com",Subject:"Hey a new User just booked you as a guide!",Body:"Hola Guide,<br> \n New Booking has arrived, please login to your Tourist Guide Account or refer this link : https://touristguide.netlify.com"}).then(function(e){console.log(e),Swal.hideLoading(),Swal.fire("Guide Booked!","","success")})}).catch(function(e){Swal.hideLoading(),Swal.fire("Oops! Something Went Wrong "+e,"","error")})):(o=[],l.UserId=n,l.CustomerName=d,o.push(l),(a={}).BookingDetails=o,db.collection("Booking").doc(n).set(a).then(function(){Email.send({SecureToken:"8d4f68cb-5259-4e47-a3a2-dd219901e043",To:l.guideEmail,From:"tooristguide@gmail.com",Subject:"Hey a new User just booked you as a guide!",Body:"Hola Guide,<br> \n New Booking has arrived, please login to your Tourist Guide Account or refer this link : https://touristguide.netlify.com"}).then(function(e){console.log(e),Swal.hideLoading(),Swal.fire("Guide Booked!","","success")})}).catch(function(e){Swal.hideLoading(),Swal.fire("Oops! Something Went Wrong "+e,"","error")}))}).catch(function(e){console.log("Error getting documents: ",e),Swal.hideLoading(),Swal.showValidationMessage("Error Occured")})):(Swal.hideLoading(),Swal.showValidationMessage("Please Login to Book Guide"))})):(Swal.hideLoading(),Swal.showValidationMessage("Please select a valid date & Name"))}$(function(){getAllGuides(),$("#txtSearchTable").on("input",function(){var e=$(this).val().toLowerCase();$("#tableListForGuide tr").filter(function(){$(this).toggle(-1<$(this).text().toLowerCase().indexOf(e))})})});